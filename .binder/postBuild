#!/bin/bash
set -e

# Install pixi
curl -fsSL https://pixi.sh/install.sh | sh
export PATH="$HOME/.pixi/bin:$PATH"

# Clone underworld3 from uw3-release-candidate branch
git clone --single-branch --branch uw3-release-candidate https://github.com/underworldcode/underworld3.git
cd underworld3

# Install runtime environment via pixi (fast resolver)
pixi install -e runtime

# Build underworld3
pixi run -e runtime build

# Install Jupyter kernel pointing to pixi environment
pixi run -e runtime python -m ipykernel install --user --name=uw3 --display-name="Underworld3"

cd ..

# Copy beginner tutorials to workspace
cp -r underworld3/docs/beginner/tutorials ./Tutorials

echo "Build completed at $(date)" > ~/.time_of_env_creation
